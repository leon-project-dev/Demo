# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]   
    paths-ignore: ["*.txt","*.md", "LICENSE", "*.xmind", "*.doc", "*.docx", "*.yml", "*.ymal"]
  

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: windows-latest    

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v3
      
      - name: clean
        run: dotnet clean
      
      - name: Install dependencies
        run: dotnet restore

      - name: build
        run: dotnet msbuild

      # TODO: 将编译好的文件传输到远程服务供下载
      - name: deploy
        run: echo deploy to 
     
      - name: Dump Github context
        env:
          GITHUB_CONTEXT: ${{ toJSON(github) }}
        run: echo "$GITHUB_CONTEXT"
      - name: Slack Notification on SUCCESS
        if: success()
        uses: Laurenfrost/mention-to-slack@latest
        with:   
          repo-token: "AAAA"
          slack-webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
          icon-url: https://github.githubassets.com/images/modules/logos_page/Octocat.png
          bot-name: "Jock"
          run-id: "1001"
          debug-flag: false
      
      
